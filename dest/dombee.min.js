var Dombee=function(){"use strict";function e(e,t){const n="function"==typeof e?e.toString():e;return Object.keys(t).filter(e=>n.match(new RegExp("\\b"+e+"\\b")))}function t(e,t){const n=Object.keys(t);return Function(...n,"return "+e+";")}function n(e,t){const n=Object.keys(t);return Function(...n,"return `"+e+"`;")}function o(e,{state:t,values:n}){if(null==e)throw new Error("Dombee.directive(config) failed. The first parameter must be a config object or function, but is null.");let o=e;if("function"==typeof e){if(o=e({state:t,data:n}),null==o)throw new Error("Dombee.directive(config) failed. Your first parameter is a function ("+e+") but it returns null. Did you forget to return the configuration?");o.name=e.name}if(null==o.onChange)throw new Error('Dombee.directive(config) failed. Your directive config needs property "onChange" to be initialized successfully.');if("function"!=typeof o.onChange)throw new Error("Dombee.directive(config) failed. config.onChange must be a function.");if("function"!=typeof o.expressions)throw new Error("Dombee.directive(config) failed. config.expressions must be a function. But it is typeof "+typeof e.expressions);return null==o.bindTo&&(o.bindTo="*"),o}function r(e="",t,n,o){const r=Object.values(n);return("string"==typeof e?function(e,t,n){for(let o of t)try{if(null==o.fn)throw`Expressiontype "${o.key}" does not exist. If the name is correct, please add it with "Dombee.addExpressionType('${expressionTypeKey}', function(text,values){/*your code here*/})"`;return o.fn(e,n)}catch(e){if("string"==typeof e)throw new Error(e)}throw new Error(`Expression "${e}" can not be parsed.`)}(e,t,o):e)(...r)}function s(e=""){return e+Math.random().toString(36).substring(2,15)}let i;const a=new function(e={}){let t=e;const n=function(e,n){if(n&&!e)throw new Error('Error in Cache: key is null but value is defined. cache(null,"value"). But it should be: cache(), cache(key),cache(key,value)');return e&&t[e]?t[e]:(n&&(t[e]="function"==typeof n?n():n),e?t[e]:t)};return n.reset=function(){t={}},n};function c(){i={directives:[],directivesObj:{},noDirectives:{},events:{onload:[]},dependencyEvaluationStrategy:e,expressionTypes:{js:t,"js-template-string":n},defaultExpressionTypes:["js","js-template-string"]},a.reset()}function u(e){const t={_localDumbeeCache:!0,bindings:{},dependencies:{},stateDependencies:{}},n=function(e){const t=u.documentMock||document;let n=t.createElement("div");return function(e){try{return null!=e.tagName}catch(e){return!1}}(e.bindTo)&&(n=e.bindTo),e.bindTo&&(n=t.querySelector(e.bindTo)),e.template&&(n.innerHTML=e.template),n}(e=function(e={}){null==e.data&&(e.data={});return e}(e)),c=new Proxy(e.data,{set(e,n,o){e[n]=o,a.reset(),p(e,n,o);for(let o of t.stateDependencies[n]||[])p(e,o,c[o]);return!0},get:(e,t)=>e[t]});for(let e of i.events.onload)e({cache:t,state:c,$root:n});function l(e="",n,o={},r){const a=e.expression?e.expression.toString():e.toString(),u=i.dependencyEvaluationStrategy(a,c),l=function(e){return e&&e.expressionTypes?Array.isArray(e.expressionTypes)?e.expressionTypes:[e.expressionTypes]:i.defaultExpressionTypes}(o),d=s("id");for(let s of u)t.dependencies[s]||(t.dependencies[s]=[]),s!==n&&(t.dependencies[s].push(d),t.bindings[d]={name:n,$elem:r,onChange:o.onChange,resultFn:e.expression?e.expression:e,expressionTypes:l,expression:e,expressionTypes:l})}function d(e){const t={};return Object.keys(c).forEach(n=>{let o=c[n],r=o;"function"==typeof o&&(o=o(c),r=o),null==o&&(r="''"),"string"==typeof o&&e&&(r=`'${o}'`),"object"==typeof o&&e&&(r=JSON.stringify(o)),t[n]=r}),t}function f(e){const t=e.toLowerCase();let n=i.directivesObj[t];if(n)return n;if(i.noDirectives[t])return[];for(let t of Object.keys(i.directivesObj))if(e.startsWith(t))return i.directivesObj[t];return i.noDirectives[t]=!0,[]}for(let e of i.directives){const t=o(e,{$root:n,state:c,values:d}),r=t.bindTo.toLowerCase();i.directivesObj[r]||(i.directivesObj[r]=[]),i.directivesObj[r].push(t)}n.querySelectorAll("*").forEach(e=>{e.dataset||(e.dataset={});const t=f("*");for(let n of t){let t=n.expressions(e);if(null!=t){Array.isArray(t)||(t=[t]);for(let o of t)o&&l(o,0,n,e)}}for(let t of e.attributes){const n=f(t.name);for(let t of n){let n=t.expressions(e);if(null!=n){Array.isArray(n)||(n=[n]);for(let o of n)o&&l(o,0,t,e)}}}});const p=(e,o,s)=>{const c=t.dependencies[o]||[];for(let e of c){const c=t.bindings[e],u=c.$elem,l=a(c.expression,()=>r(c.resultFn,c.expressionTypes.map(e=>({key:e,fn:i.expressionTypes[e]})),d(),d("parsable")));c.onChange&&c.onChange(u,l,{values:d,property:o,value:s,expression:c.expression,$root:n})}};return Object.keys(c).forEach(e=>{if("function"==typeof c[e]){const n=c[e],o=i.dependencyEvaluationStrategy(n,c).filter(t=>t!=e);for(let n of o)t.stateDependencies[n]||(t.stateDependencies[n]=[]),t.stateDependencies[n].push(e)}p(c,e,c[e])}),{state:c,values:d(),watch:function(e,t){},cache:t,$root:n}}function l(e){i.events.onload.push(e)}function d(e){i.directives.push(e)}return c(),Object.assign(u,{directive:d,dependencyEvaluationStrategy:function(e){if(null==e)throw new Error("fn is null but must be a function;");u.dependencyEvaluationStrategy=e},dependencyEvaluationStrategyDefault:e,addExpressionType:function(e,t){if(null==e)throw new Error("addExpressionType(name,fn) failed.  Name is undefined");if(null==t)throw new Error("addExpressionType(name,fn) failed. Function fn is undefined");if(getScope(this).globalCache.expressionTypes[e])throw new Error("addExpressionType(name,fn) failed. Expressiontype "+e+" already exists an can not be overwritten. Please choose another name");u.expressionTypes[e]=t},expressionTypeJs:t,expressionTypeJsTemplateString:n,addPlugin:function(e){e(u)},onLoad:l,globalCache:i,reset:c,_id:s()}),l((function({$root:e}){e.querySelectorAll("*").forEach(e=>{const t=[...[].reduce.call(e.childNodes,(function(e,t){return e+(3===t.nodeType?t.textContent:"")}),"").trim().matchAll(/{{.*?}}/g)];if(!t.length)return;const n=t.map(e=>({expression:e[0].replace("{{","").replace("}}",""),raw:e[0]}));let o=e.innerHTML;for(let e of n)o=o.replace(e.raw,`<span data-interpolation="${e.expression}"></span>`);e.innerHTML=o})})),d({name:"inputElementCheckboxes",bindTo:"data-model",expressions:e=>{if("input"!=!e.tagName&&"checkbox"==e.getAttribute("type"))return e.dataset.model},onChange(e,t,{property:n,value:o}){o?e.setAttribute("checked","checked"):e.removeAttribute("checked")}}),d((function(){return{bindTo:"data-model",expressions:e=>{if("input"!=!e.tagName&&"radio"!=e.getAttribute("type"))return e.dataset.model},onChange(e,t,{property:n,value:o}){e.value=o}}})),d((function(){return{bindTo:"data-model",expressions:e=>{if("input"!=!e.tagName&&"radio"===e.getAttribute("type"))return e.dataset.model},onChange(e,t,{property:n,value:o}){e.value==o&&e.setAttribute("checked","checked")}}})),d((function(){return{expressionTypes:"js",bindTo:"data-interpolation",expressions:e=>e.dataset.interpolation,onChange(e,t,n){e.innerText=t}}})),d((function(){return{bindTo:"data-html",expressions:e=>e.dataset.html,onChange(e,t,n){e.innerHTML=t}}})),d((function(){return{bindTo:"data-text",expressions:e=>e.dataset.text,onChange(e,t,n){e.innerText=t}}})),d((function(){return{bindTo:"data-bind",expressions:e=>Object.keys(e.attributes).filter(t=>e.attributes[t].name.startsWith("data-bind:")||e.attributes[t].name.startsWith(":")).map(t=>{const n=e.attributes[t].name;return{expression:e.getAttribute(n),attributeName:n.replace("data-bind:","").replace(":","")}}),onChange(e,t,{expression:n}){e.setAttribute(n.attributeName,t)}}})),d((function(){return{bindTo:"data-class",expressions:e=>e.dataset.class,onChange(e,t,n){"object"==typeof t?Object.keys(t).forEach(n=>{t[n]?e.classList.add(n):e.classList.remove(n)}):e.setAttribute("class",t)}}})),d((function(){return{bindTo:"data-style",expressions:e=>e.dataset.style,onChange(e,t,n){"object"==typeof t?Object.keys(t).forEach(n=>{e.style[n]=t[n]}):e.setAttribute("style",t)}}})),d((function(){return{bindTo:"data-style:",expressions:e=>Object.keys(e.dataset).filter(e=>e.startsWith("style:")).map(t=>e.dataset[t]),onChange(e,t,{property:n}){e.style[n]=t}}})),d((function(){return{bindTo:"data-class:",expressions:e=>Object.keys(e.dataset).filter(e=>e.startsWith("class:")).map(t=>({expression:e.dataset[t],classname:t.replace("class:","")})),onChange(e,t,{property:n,value:o,expression:r}){t?e.classList.add(r.classname):e.classList.remove(r.classname)}}})),d((function(){return{bindTo:"data-show",expressions:e=>e.dataset.show,onChange(e,t){e.style.display=t?"block":"none"}}})),l((function({state:e,$root:t}){const n=t.querySelectorAll('[data-model]:not([type="checkbox"])'),o=t.querySelectorAll('input[data-model][type="checkbox"]');for(let t of n)t.addEventListener("keyup",(function(){const n=t.dataset.model;e[n]=t.value})),t.addEventListener("change",(function(){const n=t.dataset.model;e[n]=t.value}));for(let t of o)t.addEventListener("change",(function(){const n=t.dataset.model;e[n]=t.checked}))})),u}();
